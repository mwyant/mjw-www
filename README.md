mjw-www — deployment notes

Overview
- This directory contains the website for mikewyantjr.com.
- Current document root (Apache vhost): `/var/www/sites/mjw-www/public`

Repository
- Source was cloned from: `https://github.com/mwyant/www-mjw.git`
- A pre-clone backup was saved (if applicable) at:
  `apache/websites/mjw-www/public.bak_<timestamp>`

How Apache is configured
- Virtual host file: `apache/sites-available/001-mjw-www.conf`
- DocumentRoot: `/var/www/sites/mjw-www/public` (adjust vhost or move files if your site lives in `public/site`)

Nginx Proxy Manager (NPM)
- Reverse proxy sits in the `nginx-proxy-manager` container and forwards `mikewyantjr.com` → `apache:80` (internal).
- NPM certs: `/etc/letsencrypt/live/npm-5/fullchain.pem` (managed by NPM + Certbot via DNS Cloudflare)
- NPM DB: `nginx/data/database.sqlite` (proxy host config stored here)

Key paths (workspace)
- Site files: `apache/websites/mjw-www/public/`
- Apache vhost: `apache/sites-available/001-mjw-www.conf`
- NPM data: `nginx/data/`
- Compose: `docker-compose.yml`
- Env template: `env.template`

Permissions
- Files are owned by the cloning user (`mwyant`). If Apache requires `www-data` ownership, run:
  - `sudo chown -R www-data:www-data /path/to/apache/websites/mjw-www/public`

Quick troubleshooting
- Test NPM → Apache from inside container:
  - `docker compose exec nginx-proxy-manager curl -I -H "Host: mikewyantjr.com" http://apache:80`
- Check NPM cert:
  - `docker compose exec nginx-proxy-manager openssl x509 -in /etc/letsencrypt/live/npm-5/fullchain.pem -noout -subject -dates`
- Reload Apache after vhost changes:
  - `docker compose exec apache apachectl -k graceful`

Notes
- If site files are in `public/site/`, either:
  - Move `public/site/*` up into `public/`, or
  - Change DocumentRoot to `/var/www/sites/mjw-www/public/site` in `001-mjw-www.conf`, then reload Apache.

Security / tokens
- If you provided a PAT to clone the private repo, rotate/revoke it if it was temporary.
- NPM uses a Cloudflare DNS credential file at `/etc/letsencrypt/credentials/credentials-5` inside the container; keep it secured.

Backups & Rollback
- Pre-clone backup (timestamped): `apache/websites/mjw-www/public.bak_<timestamp>` — restore by moving that back to `public` if needed.

Final recommendations
- Serve the site by moving files or updating DocumentRoot as noted above.
- Ensure correct ownership/permissions for Apache/PHP runtime.

Recent changes
- 2026-02-02: Added dismissible BSFA Awards longlist banner and badge to `websites/mjw-www/public/index.html`. Only flat files were modified; no server, docker, or Caddy changes were made.

Files modified
- `websites/mjw-www/public/index.html` — added BFSA banner, badge, ARIA label, and dismiss script/CSS.
- `README.md` — this documentation update.

How to deploy
- No server-side edits are required for this change. To apply on the live host, run your normal restart/deploy process (example):
  - `./scripts/restart.sh`
  - `./scripts/smoke-test.sh`
- The banner is dismissible and stores the dismissed state in `localStorage` under the key `bfsa-dismissed`.

How to revert
- Remove the banner block from `websites/mjw-www/public/index.html` or revert this commit in git.

Generated by: assistant
Date: 2026-02-02
